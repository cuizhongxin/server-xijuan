<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tencent.wxcloudrun.dao.SupplyTransportMapper">

    <insert id="insert">
        INSERT INTO supply_transport
            (user_id, grade_id, grade_name, silver_reward, paper_reward, food_reward, metal_reward,
             start_time, end_time, create_date)
        VALUES
            (#{userId}, #{gradeId}, #{gradeName}, #{silverReward}, #{paperReward}, #{foodReward}, #{metalReward},
             #{startTime}, #{endTime}, #{createDate})
    </insert>

    <select id="findActiveByUserId" resultType="java.util.HashMap">
        SELECT id, user_id AS userId, grade_id AS gradeId, grade_name AS gradeName,
               silver_reward AS silverReward, paper_reward AS paperReward,
               food_reward AS foodReward, metal_reward AS metalReward,
               start_time AS startTime, end_time AS endTime,
               speed_up_minutes AS speedUpMinutes, robbed_count AS robbedCount,
               robbed_silver AS robbedSilver, robbed_paper AS robbedPaper,
               robbed_food AS robbedFood, robbed_metal AS robbedMetal,
               status, create_date AS createDate
        FROM supply_transport
        WHERE user_id = #{userId} AND status = 'active'
        ORDER BY start_time DESC
        LIMIT 1
    </select>

    <select id="findByUserIdAndDate" resultType="java.util.HashMap">
        SELECT id, user_id AS userId, grade_id AS gradeId, grade_name AS gradeName,
               silver_reward AS silverReward, paper_reward AS paperReward,
               food_reward AS foodReward, metal_reward AS metalReward,
               start_time AS startTime, end_time AS endTime,
               speed_up_minutes AS speedUpMinutes, robbed_count AS robbedCount,
               robbed_silver AS robbedSilver, robbed_paper AS robbedPaper,
               robbed_food AS robbedFood, robbed_metal AS robbedMetal,
               status, create_date AS createDate
        FROM supply_transport
        WHERE user_id = #{userId} AND create_date = #{createDate}
        ORDER BY start_time DESC
    </select>

    <select id="findAllActive" resultType="java.util.HashMap">
        SELECT id, user_id AS userId, grade_id AS gradeId, grade_name AS gradeName,
               silver_reward AS silverReward, paper_reward AS paperReward,
               food_reward AS foodReward, metal_reward AS metalReward,
               start_time AS startTime, end_time AS endTime,
               speed_up_minutes AS speedUpMinutes, robbed_count AS robbedCount,
               robbed_silver AS robbedSilver, robbed_paper AS robbedPaper,
               robbed_food AS robbedFood, robbed_metal AS robbedMetal,
               status
        FROM supply_transport
        WHERE status = 'active'
        ORDER BY start_time DESC
    </select>

    <select id="findById" resultType="java.util.HashMap">
        SELECT id, user_id AS userId, grade_id AS gradeId, grade_name AS gradeName,
               silver_reward AS silverReward, paper_reward AS paperReward,
               food_reward AS foodReward, metal_reward AS metalReward,
               start_time AS startTime, end_time AS endTime,
               speed_up_minutes AS speedUpMinutes, robbed_count AS robbedCount,
               robbed_silver AS robbedSilver, robbed_paper AS robbedPaper,
               robbed_food AS robbedFood, robbed_metal AS robbedMetal,
               status
        FROM supply_transport
        WHERE id = #{id}
    </select>

    <update id="updateRobbed">
        UPDATE supply_transport
        SET robbed_count = #{robbedCount},
            robbed_silver = #{robbedSilver}, robbed_paper = #{robbedPaper},
            robbed_food = #{robbedFood}, robbed_metal = #{robbedMetal}
        WHERE id = #{id}
    </update>

    <update id="updateEndTime">
        UPDATE supply_transport
        SET end_time = #{endTime}, speed_up_minutes = #{speedUpMinutes}
        WHERE id = #{id}
    </update>

    <update id="updateStatus">
        UPDATE supply_transport SET status = #{status} WHERE id = #{id}
    </update>

</mapper>
